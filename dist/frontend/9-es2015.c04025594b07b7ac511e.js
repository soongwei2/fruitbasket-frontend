(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{g1eW:function(t,e,o){"use strict";o.r(e);var c=o("ofXK"),n=o("bTqV"),i=o("0IaG"),a=o("NFeN"),r=o("+0xr"),s=o("/t3+"),b=o("PCNd"),l=o("tyNb"),u=o("mPKh"),d=o("LvDl"),m=o.n(d),p=o("itXk"),h=o("IzEk"),f=o("3Pt+"),g=o("XbkK"),C=o("dxtN"),S=o("fXoL"),y=o("kt0X"),x=o("kmnG"),w=o("qFsG");let T=(()=>{class t{constructor(t,e,o){this.dialogRef=t,this.data=e,this.store=o,this.form=new f.d({couponCode:new f.b(null,[f.l.required])}),this.couponCode$=this.store.select(C.b.couponCode)}ngOnInit(){this.dialogRef.afterClosed().subscribe(t=>{this.couponCode$$&&this.couponCode$$.unsubscribe()})}onCancel(){this.dialogRef.close()}onSubmit(t){this.couponCode$$&&this.couponCode$$.unsubscribe(),this.couponCode$$=this.couponCode$.subscribe(t=>{t&&this.dialogRef.close()});const e=Object.assign({},this.form.value);this.store.dispatch(Object(g.f)({code:e.couponCode}))}}return t.\u0275fac=function(e){return new(e||t)(S.Nb(i.f),S.Nb(i.a),S.Nb(y.h))},t.\u0275cmp=S.Hb({type:t,selectors:[["ng-component"]],decls:19,vars:2,consts:[["mat-dialog-content",""],[3,"formGroup","ngSubmit"],["matInput","","type","text","formControlName","couponCode","cdkFocusInitial",""],["mat-dialog-actions",""],[1,"button"],["type","button","mat-stroked-button","",3,"click"],[1,"spacer"],["type","submit","mat-raised-button","","color","primary","cdkFocusInitial","",3,"disabled","click"]],template:function(t,e){1&t&&(S.Tb(0,"div",0),S.Tb(1,"h3"),S.xc(2,"Enter your coupon code"),S.Sb(),S.Sb(),S.Tb(3,"div"),S.Tb(4,"form",1),S.bc("ngSubmit",(function(t){return e.onSubmit(t)})),S.Tb(5,"mat-form-field"),S.Tb(6,"mat-label"),S.xc(7,"Coupon Code"),S.Sb(),S.Ob(8,"input",2),S.Tb(9,"mat-error"),S.xc(10,"Invalid coupon code"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(11,"div",3),S.Tb(12,"div",4),S.Tb(13,"button",5),S.bc("click",(function(){return e.onCancel()})),S.xc(14,"Cancel"),S.Sb(),S.Sb(),S.Ob(15,"span",6),S.Tb(16,"div",4),S.Tb(17,"button",7),S.bc("click",(function(t){return e.onSubmit(t)})),S.xc(18,"Ok"),S.Sb(),S.Sb(),S.Sb()),2&t&&(S.Cb(4),S.kc("formGroup",e.form),S.Cb(13),S.kc("disabled",e.form.get("couponCode").invalid))},directives:[i.d,f.m,f.i,f.e,x.b,x.e,w.a,f.a,f.h,f.c,x.a,i.c,n.a],styles:[""]}),t})();var k=o("7DNW"),O=o("CHL8"),v=o("0EQZ"),D=o("XSh8"),P=o("lJxs");class _ extends v.b{constructor(t){super(),this.store=t}connect(){return Object(p.a)(this.store.select(C.b.list),this.store.select(C.b.couponCode)).pipe(Object(P.a)(t=>Object(D.promotion)(t[0],t[1])))}subTotal(){return this.connect().pipe(Object(P.a)(t=>t.reduce((t,e)=>t+Math.round(100*(e.totalPrice+Number.EPSILON))/100,0)))}disconnect(){}}var j=o("ALGp"),$=o("mYFD"),R=o("B9kR"),N=o("Qu3c");function I(t,e){1&t&&(S.Tb(0,"th",24),S.xc(1," Name "),S.Sb())}function M(t,e){if(1&t&&(S.Tb(0,"td",25),S.xc(1),S.Tb(2,"span",26),S.xc(3),S.Sb(),S.Sb()),2&t){const t=e.$implicit,o=S.ec();S.Cb(1),S.zc(" ",o._.get(t,"product.name")||o._.get(t,"promotion.name")," "),S.Cb(2),S.zc(" ",o._.get(t,"product.name")&&o._.get(t,"promotion.name")?" ("+o._.get(t,"promotion.name")+")":""," ")}}function q(t,e){1&t&&(S.Tb(0,"th",27),S.xc(1," Unit Price "),S.Sb())}function B(t,e){if(1&t&&(S.Tb(0,"td",28),S.xc(1),S.fc(2,"currency"),S.Sb()),2&t){const t=e.$implicit,o=S.ec();S.Cb(1),S.zc(" ",S.gc(2,1,o._.get(t,"product.price")||o._.get(t,"promotionPrice"))," ")}}function G(t,e){1&t&&(S.Tb(0,"th",29),S.xc(1," Quantity "),S.Sb())}function H(t,e){if(1&t){const t=S.Ub();S.Tb(0,"td",30),S.Tb(1,"div",31),S.Tb(2,"button",32),S.bc("click",(function(){S.qc(t);const o=e.$implicit;return S.ec().removeItem(o)})),S.Tb(3,"mat-icon"),S.xc(4,"indeterminate_check_box"),S.Sb(),S.Sb(),S.Tb(5,"div",33),S.xc(6),S.Sb(),S.Tb(7,"button",34),S.bc("click",(function(){S.qc(t);const o=e.$implicit;return S.ec().addItem(o)})),S.Tb(8,"mat-icon"),S.xc(9,"add_box"),S.Sb(),S.Sb(),S.Sb(),S.Sb()}if(2&t){const t=e.$implicit;S.Cb(6),S.yc(t.quantity)}}function F(t,e){1&t&&(S.Tb(0,"th",35),S.xc(1," TotalPrice "),S.Sb())}function z(t,e){if(1&t&&(S.Tb(0,"td",28),S.Tb(1,"span",36),S.xc(2),S.fc(3,"currency"),S.Sb(),S.xc(4),S.fc(5,"currency"),S.Sb()),2&t){const t=e.$implicit;S.Cb(2),S.yc(S.gc(3,2,t.originalPrice)),S.Cb(2),S.zc("",S.gc(5,4,t.totalPrice)," ")}}function E(t,e){1&t&&S.Ob(0,"tr",37)}function A(t,e){1&t&&S.Ob(0,"tr",38)}function L(t,e){1&t&&(S.Tb(0,"div",39),S.xc(1,"Basket is empty"),S.Sb())}function Q(t,e){if(1&t){const t=S.Ub();S.Tb(0,"div",40),S.Tb(1,"button",41),S.bc("click",(function(){S.qc(t);const o=e.$implicit;return S.ec().onCoupon(o)})),S.xc(2),S.Sb(),S.Tb(3,"span",42),S.xc(4),S.Sb(),S.Ob(5,"span",5),S.Tb(6,"span",43),S.xc(7),S.fc(8,"currency"),S.fc(9,"async"),S.Sb(),S.Tb(10,"button",44),S.bc("click",(function(){return S.qc(t),S.ec().onCheckout()})),S.xc(11,"Checkout"),S.Sb(),S.Sb()}if(2&t){const t=e.$implicit,o=S.ec();S.Cb(2),S.yc(t?"Remove Coupon":"Add Coupon"),S.Cb(2),S.yc(t),S.Cb(3),S.zc(" Total: ",S.gc(8,3,S.gc(9,5,o.dataSource.subTotal())),"")}}const X=function(t){return[t]},K=[{path:"",component:(()=>{class t{constructor(t,e,o,c){this.store=t,this.dialog=e,this.dialogPaymentService=o,this.productService=c,this.dataSource=new _(this.store),this.displayedColumns=["name","unitPrice","quantity","totalPrice"],this.formatMonies=u.formatMonies,this._=m.a,this.coupon$=this.store.select(C.b.couponCode)}ngOnInit(){}addItem(t){t.product?this.store.dispatch(Object(g.b)({product:t.product})):t.promotion.promotionRules.forEach(t=>{const e=t.quantity,o=t.product;this.store.dispatch(Object(g.b)({product:o,count:e}))})}removeItem(t){t.product?this.store.dispatch(Object(g.d)({product:t.product})):t.promotion.promotionRules.forEach(t=>{const e=t.quantity,o=t.product;this.store.dispatch(Object(g.d)({product:o,count:e}))})}onCheckout(){Object(p.a)(this.dataSource.connect(),this.dataSource.subTotal()).pipe(Object(h.a)(1)).toPromise().then(t=>{t[0].length?this.dialogPaymentService.open({basketArr:this.dataSource.connect(),subTotal:this.dataSource.subTotal()}):this.store.dispatch(Object(k.g)({message:"Basket is empty"}))})}onCoupon(t){if(t)return this.store.dispatch(Object(k.g)({message:"Removed coupon code"})),void this.store.dispatch(Object(g.a)({code:null}));this.dialog.open(T,{width:"300px",data:{}})}onGenerate(){const t=Math.random().toString(36).slice(2).substring(0,5).toUpperCase();console.log("genCouponCode: ",t);const e={name:"30% Discount on Oranges",discount:30,type:"more_than",quantity:1,couponCode:t,expiryDate:new Date((new Date).getTime()+3e4),promotionRules:[{condition:">=",quantity:1,productId:"B9B69146-A55D-4B7A-A698-DF54CFE03ED0"}]};this.store.dispatch(Object(O.a)({promotion:e}))}}return t.\u0275fac=function(e){return new(e||t)(S.Nb(y.h),S.Nb(i.b),S.Nb(j.a),S.Nb($.a))},t.\u0275cmp=S.Hb({type:t,selectors:[["app-basket"]],decls:31,vars:12,consts:[[1,"container"],["color","primary",1,"app-toolbar"],["backButton","","mat-icon-button","","aria-label","Back"],["aria-hidden","false","matBadgeColor","accent"],[2,"margin-left","16px"],[1,"spacer"],["mat-raised-button","","aria-label","Generate","matTooltip","Generate a one time use, 30 seconds coupon for oranges",3,"click"],[1,"content"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","style","width: 40%;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","unitPrice"],["mat-header-cell","","style","text-align: right;width: 15%;",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right;",4,"matCellDef"],["matColumnDef","quantity"],["mat-header-cell","","style","text-align: center;width: 20%;",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","totalPrice"],["mat-header-cell","","style","text-align: right;width: 25%;",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","empty",4,"ngIf"],["class","footer",4,"ngFor","ngForOf"],["mat-header-cell","",2,"width","40%"],["mat-cell",""],[2,"color","red"],["mat-header-cell","",2,"text-align","right","width","15%"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",2,"text-align","center","width","20%"],["mat-cell","",1,"text-center"],[2,"display","flex","justify-content","center"],["mat-icon-button","","aria-label","Minus",3,"click"],[2,"width","20px","display","inline-flex","align-items","center","justify-content","center"],["mat-icon-button","","aria-label","Add",3,"click"],["mat-header-cell","",2,"text-align","right","width","25%"],[1,"line-through",2,"margin-right","10px"],["mat-header-row",""],["mat-row",""],[1,"empty"],[1,"footer"],["mat-stroked-button","",2,"margin-right","16px",3,"click"],[1,"coupon"],[1,"subtotal",2,"margin-right","16px"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,e){1&t&&(S.Tb(0,"div",0),S.Tb(1,"mat-toolbar",1),S.Tb(2,"mat-toolbar-row"),S.Tb(3,"button",2),S.Tb(4,"mat-icon",3),S.xc(5,"arrow_back"),S.Sb(),S.Sb(),S.Tb(6,"span",4),S.xc(7,"Basket"),S.Sb(),S.Ob(8,"span",5),S.Tb(9,"button",6),S.bc("click",(function(){return e.onGenerate()})),S.xc(10," Generate "),S.Sb(),S.Sb(),S.Sb(),S.Tb(11,"div",7),S.Tb(12,"table",8),S.Rb(13,9),S.wc(14,I,2,0,"th",10),S.wc(15,M,4,2,"td",11),S.Qb(),S.Rb(16,12),S.wc(17,q,2,0,"th",13),S.wc(18,B,3,3,"td",14),S.Qb(),S.Rb(19,15),S.wc(20,G,2,0,"th",16),S.wc(21,H,10,1,"td",17),S.Qb(),S.Rb(22,18),S.wc(23,F,2,0,"th",19),S.wc(24,z,6,6,"td",14),S.Qb(),S.wc(25,E,1,0,"tr",20),S.wc(26,A,1,0,"tr",21),S.Sb(),S.wc(27,L,2,0,"div",22),S.fc(28,"async"),S.Sb(),S.wc(29,Q,12,7,"div",23),S.fc(30,"async"),S.Sb()),2&t&&(S.Cb(12),S.kc("dataSource",e.dataSource),S.Cb(13),S.kc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),S.Cb(1),S.kc("matRowDefColumns",e.displayedColumns),S.Cb(1),S.kc("ngIf",!S.gc(28,6,e.dataSource.connect()).length),S.Cb(2),S.kc("ngForOf",S.mc(10,X,S.gc(30,8,e.coupon$))))},directives:[s.a,s.c,n.a,R.a,a.a,N.a,r.j,r.c,r.e,r.b,r.g,r.i,c.m,c.l,r.d,r.a,r.f,r.h],pipes:[c.b,c.d],styles:["table[_ngcontent-%COMP%]{width:100%}.line-through[_ngcontent-%COMP%]{text-decoration:line-through}.container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}.content[_ngcontent-%COMP%]{flex-shrink:1;flex-grow:1;padding:16px;position:relative;overflow-y:auto}.footer[_ngcontent-%COMP%]{display:flex;padding:16px}.coupon[_ngcontent-%COMP%]{color:red}.coupon[_ngcontent-%COMP%], .subtotal[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-weight:700}.subtotal[_ngcontent-%COMP%]{font-size:1.17em}.empty[_ngcontent-%COMP%]{margin-top:64px;justify-content:center;display:flex}"]}),t})()}];let U=(()=>{class t{}return t.\u0275mod=S.Lb({type:t}),t.\u0275inj=S.Kb({factory:function(e){return new(e||t)},imports:[[l.c.forChild(K)],l.c]}),t})();o.d(e,"BasketModule",(function(){return W}));const J=[b.a,s.b,a.b,n.b,i.e,r.k,N.b];let W=(()=>{class t{}return t.\u0275mod=S.Lb({type:t}),t.\u0275inj=S.Kb({factory:function(e){return new(e||t)},imports:[[c.c,U,J]]}),t})()}}]);