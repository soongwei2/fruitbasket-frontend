(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{g1eW:function(t,e,o){"use strict";o.r(e);var c=o("ofXK"),n=o("bTqV"),i=o("0IaG"),a=o("NFeN"),r=o("+0xr"),s=o("/t3+"),b=o("PCNd"),l=o("tyNb"),u=o("LvDl"),d=o.n(u),m=o("itXk"),p=o("IzEk"),h=o("3Pt+"),f=o("XbkK"),g=o("dxtN"),C=o("fXoL"),S=o("kt0X"),y=o("kmnG"),x=o("qFsG");let w=(()=>{class t{constructor(t,e,o){this.dialogRef=t,this.data=e,this.store=o,this.form=new h.d({couponCode:new h.b(null,[h.l.required])}),this.couponCode$=this.store.select(g.b.couponCode)}ngOnInit(){this.dialogRef.afterClosed().subscribe(t=>{this.couponCode$$&&this.couponCode$$.unsubscribe()})}onCancel(){this.dialogRef.close()}onSubmit(t){this.couponCode$$&&this.couponCode$$.unsubscribe(),this.couponCode$$=this.couponCode$.subscribe(t=>{t&&this.dialogRef.close()});const e=Object.assign({},this.form.value);this.store.dispatch(Object(f.f)({code:e.couponCode}))}}return t.\u0275fac=function(e){return new(e||t)(C.Nb(i.f),C.Nb(i.a),C.Nb(S.h))},t.\u0275cmp=C.Hb({type:t,selectors:[["ng-component"]],decls:19,vars:2,consts:[["mat-dialog-content",""],[3,"formGroup","ngSubmit"],["matInput","","type","text","formControlName","couponCode","cdkFocusInitial",""],["mat-dialog-actions",""],[1,"button"],["type","button","mat-stroked-button","",3,"click"],[1,"spacer"],["type","submit","mat-raised-button","","color","primary","cdkFocusInitial","",3,"disabled","click"]],template:function(t,e){1&t&&(C.Tb(0,"div",0),C.Tb(1,"h3"),C.xc(2,"Enter your coupon code"),C.Sb(),C.Sb(),C.Tb(3,"div"),C.Tb(4,"form",1),C.bc("ngSubmit",(function(t){return e.onSubmit(t)})),C.Tb(5,"mat-form-field"),C.Tb(6,"mat-label"),C.xc(7,"Coupon Code"),C.Sb(),C.Ob(8,"input",2),C.Tb(9,"mat-error"),C.xc(10,"Invalid coupon code"),C.Sb(),C.Sb(),C.Sb(),C.Sb(),C.Tb(11,"div",3),C.Tb(12,"div",4),C.Tb(13,"button",5),C.bc("click",(function(){return e.onCancel()})),C.xc(14,"Cancel"),C.Sb(),C.Sb(),C.Ob(15,"span",6),C.Tb(16,"div",4),C.Tb(17,"button",7),C.bc("click",(function(t){return e.onSubmit(t)})),C.xc(18,"Ok"),C.Sb(),C.Sb(),C.Sb()),2&t&&(C.Cb(4),C.kc("formGroup",e.form),C.Cb(13),C.kc("disabled",e.form.get("couponCode").invalid))},directives:[i.d,h.m,h.i,h.e,y.b,y.e,x.a,h.a,h.h,h.c,y.a,i.c,n.a],styles:[""]}),t})();var T=o("7DNW"),k=o("CHL8"),O=o("0EQZ"),v=o("WFeZ"),D=o("lJxs"),P=o("XSh8");class j extends O.b{constructor(t){super(),this.store=t}connect(){return Object(m.a)(this.store.select(g.b.list),this.store.select(g.b.couponCode)).pipe(Object(D.a)(t=>Object(v.basketListing)(t[0],t[1])))}subTotal(){return this.connect().pipe(Object(D.a)(t=>Object(P.getTotalPrice)(t)))}disconnect(){}}var _=o("ALGp"),$=o("mYFD"),R=o("B9kR"),I=o("Qu3c");function N(t,e){1&t&&(C.Tb(0,"th",24),C.xc(1," Name "),C.Sb())}function q(t,e){if(1&t&&(C.Tb(0,"td",25),C.xc(1),C.Tb(2,"span",26),C.xc(3),C.Sb(),C.Sb()),2&t){const t=e.$implicit,o=C.ec();C.Cb(1),C.zc(" ",o._.get(t,"product.name")||o._.get(t,"promotion.name")," "),C.Cb(2),C.zc(" ",o._.get(t,"product.name")&&o._.get(t,"promotion.name")?" ("+o._.get(t,"promotion.name")+")":""," ")}}function M(t,e){1&t&&(C.Tb(0,"th",27),C.xc(1," Unit Price "),C.Sb())}function B(t,e){if(1&t&&(C.Tb(0,"td",28),C.xc(1),C.fc(2,"currency"),C.Sb()),2&t){const t=e.$implicit,o=C.ec();C.Cb(1),C.zc(" ",C.gc(2,1,o._.get(t,"product.price")||o._.get(t,"promotionPrice"))," ")}}function F(t,e){1&t&&(C.Tb(0,"th",29),C.xc(1," Quantity "),C.Sb())}function G(t,e){if(1&t){const t=C.Ub();C.Tb(0,"td",30),C.Tb(1,"div",31),C.Tb(2,"button",32),C.bc("click",(function(){C.qc(t);const o=e.$implicit;return C.ec().removeItem(o)})),C.Tb(3,"mat-icon"),C.xc(4,"indeterminate_check_box"),C.Sb(),C.Sb(),C.Tb(5,"div",33),C.xc(6),C.Sb(),C.Tb(7,"button",34),C.bc("click",(function(){C.qc(t);const o=e.$implicit;return C.ec().addItem(o)})),C.Tb(8,"mat-icon"),C.xc(9,"add_box"),C.Sb(),C.Sb(),C.Sb(),C.Sb()}if(2&t){const t=e.$implicit;C.Cb(6),C.yc(t.quantity)}}function H(t,e){1&t&&(C.Tb(0,"th",35),C.xc(1," TotalPrice "),C.Sb())}function z(t,e){if(1&t&&(C.Tb(0,"td",28),C.Tb(1,"span",36),C.xc(2),C.fc(3,"currency"),C.Sb(),C.xc(4),C.fc(5,"currency"),C.Sb()),2&t){const t=e.$implicit;C.Cb(2),C.yc(C.gc(3,2,t.originalPrice)),C.Cb(2),C.zc("",C.gc(5,4,t.totalPrice)," ")}}function A(t,e){1&t&&C.Ob(0,"tr",37)}function E(t,e){1&t&&C.Ob(0,"tr",38)}function L(t,e){1&t&&(C.Tb(0,"div",39),C.xc(1,"Basket is empty"),C.Sb())}function Q(t,e){if(1&t){const t=C.Ub();C.Tb(0,"div",40),C.Tb(1,"button",41),C.bc("click",(function(){C.qc(t);const o=e.$implicit;return C.ec().onCoupon(o)})),C.xc(2),C.Sb(),C.Tb(3,"span",42),C.xc(4),C.Sb(),C.Ob(5,"span",5),C.Tb(6,"span",43),C.xc(7),C.fc(8,"currency"),C.fc(9,"async"),C.Sb(),C.Tb(10,"button",44),C.bc("click",(function(){return C.qc(t),C.ec().onCheckout()})),C.xc(11,"Checkout"),C.Sb(),C.Sb()}if(2&t){const t=e.$implicit,o=C.ec();C.Cb(2),C.yc(t?"Remove Coupon":"Add Coupon"),C.Cb(2),C.yc(t),C.Cb(3),C.zc(" Total: ",C.gc(8,3,C.gc(9,5,o.dataSource.subTotal())),"")}}const X=function(t){return[t]},K=[{path:"",component:(()=>{class t{constructor(t,e,o,c){this.store=t,this.dialog=e,this.dialogPaymentService=o,this.productService=c,this.dataSource=new j(this.store),this.displayedColumns=["name","unitPrice","quantity","totalPrice"],this._=d.a,this.coupon$=this.store.select(g.b.couponCode)}ngOnInit(){}addItem(t){t.product?this.store.dispatch(Object(f.b)({product:t.product})):t.promotion.promotionRules.forEach(t=>{const e=t.quantity,o=t.product;this.store.dispatch(Object(f.b)({product:o,count:e}))})}removeItem(t){t.product?this.store.dispatch(Object(f.d)({product:t.product})):t.promotion.promotionRules.forEach(t=>{const e=t.quantity,o=t.product;this.store.dispatch(Object(f.d)({product:o,count:e}))})}onCheckout(){Object(m.a)(this.dataSource.connect(),this.dataSource.subTotal()).pipe(Object(p.a)(1)).toPromise().then(t=>{t[0].length?this.dialogPaymentService.open({basketArr:this.dataSource.connect(),subTotal:this.dataSource.subTotal()}):this.store.dispatch(Object(T.d)({message:"Basket is empty"}))})}onCoupon(t){if(t)return this.store.dispatch(Object(T.d)({message:"Removed coupon code"})),void this.store.dispatch(Object(f.a)({code:null}));this.dialog.open(w,{width:"300px",data:{}})}onGenerate(){const t=Math.random().toString(36).slice(2).substring(0,5).toUpperCase();console.log("genCouponCode: ",t);const e={name:"30% Discount on Oranges",discount:30,type:"more_than",quantity:1,couponCode:t,expiryDate:new Date((new Date).getTime()+3e4),promotionRules:[{condition:">=",quantity:1,productId:"B9B69146-A55D-4B7A-A698-DF54CFE03ED0"}]};this.store.dispatch(Object(k.a)({promotion:e}))}}return t.\u0275fac=function(e){return new(e||t)(C.Nb(S.h),C.Nb(i.b),C.Nb(_.a),C.Nb($.a))},t.\u0275cmp=C.Hb({type:t,selectors:[["app-basket"]],decls:31,vars:12,consts:[[1,"container"],["color","primary",1,"app-toolbar"],["backButton","","mat-icon-button","","aria-label","Back"],["aria-hidden","false","matBadgeColor","accent"],[2,"margin-left","16px"],[1,"spacer"],["mat-raised-button","","aria-label","Generate","matTooltip","Generate a one time use, 30 seconds coupon for oranges",3,"click"],[1,"content"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","","style","width: 40%;",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","unitPrice"],["mat-header-cell","","style","text-align: right;width: 15%;",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right;",4,"matCellDef"],["matColumnDef","quantity"],["mat-header-cell","","style","text-align: center;width: 20%;",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["matColumnDef","totalPrice"],["mat-header-cell","","style","text-align: right;width: 25%;",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","empty",4,"ngIf"],["class","footer",4,"ngFor","ngForOf"],["mat-header-cell","",2,"width","40%"],["mat-cell",""],[2,"color","red"],["mat-header-cell","",2,"text-align","right","width","15%"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",2,"text-align","center","width","20%"],["mat-cell","",1,"text-center"],[2,"display","flex","justify-content","center"],["mat-icon-button","","aria-label","Minus",3,"click"],[2,"width","20px","display","inline-flex","align-items","center","justify-content","center"],["mat-icon-button","","aria-label","Add",3,"click"],["mat-header-cell","",2,"text-align","right","width","25%"],[1,"line-through",2,"margin-right","10px"],["mat-header-row",""],["mat-row",""],[1,"empty"],[1,"footer"],["mat-stroked-button","",2,"margin-right","16px",3,"click"],[1,"coupon"],[1,"subtotal",2,"margin-right","16px"],["mat-raised-button","","color","warn",3,"click"]],template:function(t,e){1&t&&(C.Tb(0,"div",0),C.Tb(1,"mat-toolbar",1),C.Tb(2,"mat-toolbar-row"),C.Tb(3,"button",2),C.Tb(4,"mat-icon",3),C.xc(5,"arrow_back"),C.Sb(),C.Sb(),C.Tb(6,"span",4),C.xc(7,"Basket"),C.Sb(),C.Ob(8,"span",5),C.Tb(9,"button",6),C.bc("click",(function(){return e.onGenerate()})),C.xc(10," Generate "),C.Sb(),C.Sb(),C.Sb(),C.Tb(11,"div",7),C.Tb(12,"table",8),C.Rb(13,9),C.wc(14,N,2,0,"th",10),C.wc(15,q,4,2,"td",11),C.Qb(),C.Rb(16,12),C.wc(17,M,2,0,"th",13),C.wc(18,B,3,3,"td",14),C.Qb(),C.Rb(19,15),C.wc(20,F,2,0,"th",16),C.wc(21,G,10,1,"td",17),C.Qb(),C.Rb(22,18),C.wc(23,H,2,0,"th",19),C.wc(24,z,6,6,"td",14),C.Qb(),C.wc(25,A,1,0,"tr",20),C.wc(26,E,1,0,"tr",21),C.Sb(),C.wc(27,L,2,0,"div",22),C.fc(28,"async"),C.Sb(),C.wc(29,Q,12,7,"div",23),C.fc(30,"async"),C.Sb()),2&t&&(C.Cb(12),C.kc("dataSource",e.dataSource),C.Cb(13),C.kc("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),C.Cb(1),C.kc("matRowDefColumns",e.displayedColumns),C.Cb(1),C.kc("ngIf",!C.gc(28,6,e.dataSource.connect()).length),C.Cb(2),C.kc("ngForOf",C.mc(10,X,C.gc(30,8,e.coupon$))))},directives:[s.a,s.c,n.a,R.a,a.a,I.a,r.j,r.c,r.e,r.b,r.g,r.i,c.m,c.l,r.d,r.a,r.f,r.h],pipes:[c.b,c.d],styles:["table[_ngcontent-%COMP%]{width:100%}.line-through[_ngcontent-%COMP%]{text-decoration:line-through}.container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}.content[_ngcontent-%COMP%]{flex-shrink:1;flex-grow:1;padding:16px;position:relative;overflow-y:auto}.footer[_ngcontent-%COMP%]{display:flex;padding:16px}.coupon[_ngcontent-%COMP%]{color:red}.coupon[_ngcontent-%COMP%], .subtotal[_ngcontent-%COMP%]{display:inline-flex;align-items:center;font-weight:700}.subtotal[_ngcontent-%COMP%]{font-size:1.17em}.empty[_ngcontent-%COMP%]{margin-top:64px;justify-content:center;display:flex}"]}),t})()}];let U=(()=>{class t{}return t.\u0275mod=C.Lb({type:t}),t.\u0275inj=C.Kb({factory:function(e){return new(e||t)},imports:[[l.c.forChild(K)],l.c]}),t})();o.d(e,"BasketModule",(function(){return W}));const J=[b.a,s.b,a.b,n.b,i.e,r.k,I.b];let W=(()=>{class t{}return t.\u0275mod=C.Lb({type:t}),t.\u0275inj=C.Kb({factory:function(e){return new(e||t)},imports:[[c.c,U,J]]}),t})()}}]);